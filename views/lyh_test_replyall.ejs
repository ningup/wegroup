<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="Keywords" content="微群助手－主页" />
    <meta name="Description" content="微信公众平台上的公众号－－微群助手" />
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>微群帮手测试</title>

    <!-- Bootstrap -->
    <!--<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.css">-->
    <link href="//cdn.bootcss.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="/stylesheets/weui.css">
    <script language="javascript" type="text/javascript" src="/javascript/jquery.min.js"></script>
    <!--<script language="javascript" type="text/javascript" src="/javascript/bootstrap.js"></script>-->
    <script src="//cdn.bootcss.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <!--<script src="//cdn.bootcss.com/iScroll/5.1.3/iscroll.min.js"></script>-->
    <!--<script src="//cdn.bootcss.com/iScroll/5.1.3/iscroll-lite.min.js"></script>-->
    <script src="//cdn.bootcss.com/iScroll/5.1.3/iscroll-probe.min.js"></script>

    <style type="text/css">
    body {overflow: hidden;width: 100%;background-color: #f8f8f8;} /*background-color: #FBFBFB;*/
    #wrapper {position: absolute;overflow: hidden;left: 0;top: 0;bottom: 0;width: 100%;z-index: 1;}
    .container {position: relative;padding: 0;}
    #monitor {
    position: absolute;
    left: 51%;
    z-index: 2;
    }
    
    .container>div:first-child{margin-top: 1px;}
    .container>div{padding: 10px 0 8px;background-color: #fafafa;position: relative;display: list-item;text-align: -webkit-match-parent;}
    .comment-wrapper{position: relative;padding: 0 15px 0 60px;}
    .comment-wrapper .user-avatar{position: absolute;top: 0;left: 15px;padding-right: 9px;}
    .comment-wrapper .user-avatar>img{width: 35px;height: 35px;overflow: hidden;position: relative;border-radius: 18px;font-size: 12px;background-color: #efece9;padding: 0;margin: 0;outline: 0;-webkit-tap-highlight-color:transparent;}
    .comment-wrapper .name-wrap{padding-top: 5px;width: 100%;display: inline-block;}
    .comment-wrapper .name-wrap .user-nick{display: inline-block;overflow: hidden;max-width: 115px;font-size: 14px;line-height: 19px;vertical-align: middle;white-space: nowrap;text-overflow:ellipsis;color: #777!important;font-weight: 400!important;}
    .comment-wrapper .name-wrap .lounum{float: right;padding-top: 2px;font-size: 12px;color: #bbb;}
    .comment-wrapper .content-wrapper{margin-top: 5px;color: #454545;}
    .comment-wrapper .content-wrapper .ping-content{margin-bottom: 0;clear: both;font-size: 17px;line-height: 27px;word-wrap:break-word;word-break:break-all;-webkit-user-select:initial;}
    .comment-wrapper .comment-action {margin-top: 0;margin-right: -15px;height: 22px;font-size: 12px;color: #bbb;}
    .comment-wrapper .comment-action:after{display: block;clear: both;content: "";}
    .comment-wrapper .comment-action .time{float: left;margin: 0 10px 0 0;padding: 0;position: relative;z-index: 2;height: 100%;line-height: 22px;}
    .comment-wrapper .comment-action .time:after{position: absolute;top: 10px;left: 5px;content: "";}
    .comment-wrapper .comment-action .reply{padding-right: 15px;float: right;position: relative;z-index: 2;margin-left: 7px;padding-top: 1px;padding-left: 24px;height: 100%;line-height: 22px;}
    .comment-wrapper .comment-action .reply:after{top: 3px;width: 16px;height: 16px;background: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAArlBMVEWPj4////+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj492At4UAAAAOXRSTlMAAAMEBQYHCAsMDRESFBUZGxweHzI0NTg9YWJmZ2hqbG1ub3t9kJGSlZaZuru/wsfKy83q8vP09/l6oG0XAAAA6UlEQVR4Xr3Ra0/CQBBG4RmhFW+oVQQtqOWmhQoitnL+/x9zs9lkY+tqYojn0yTvk6ZpRX9pD8DUSldb6m1XacuBW0LdGWD3xaAr9bqDhRUSw1S+TafQVnnkSQJAn7lXeeUmCPqsVT44DIJj3lVAgkBhnyBZlsvEX01QAC/+aoIS2PnrD09Iiqq48pcH//AddkRBcESpsqb/89/MmAfBnEwlhkkATCBWkSHMep0G6PRmMFIDJMWVX1pwnuMaqgUSjTcVVlz4vdqMI3XAdZIbYXbyM/eSNSCnRly73YOawO4hIAcPb1lbvoBPhOI14NP8H2QAAAAASUVORK5CYII=') center center no-repeat;background-size: 100% 100%;position: absolute;/*top: 10px;*/left: 5px;content: "";}
    .comment-wrapper .comment-action .like{color: #777;float: right;position: relative;z-index: 2;margin-left: 7px;padding-top: 1px;padding-left: 24px;height: 100%;line-height: 22px;}
    .comment-wrapper .comment-action .like:after{top: 2px;width: 16px;height: 16px;background: center center no-repeat;background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAABelBMVEWPj4////+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4+Pj4/35ViBAAAAfXRSTlMAAAJDlryGEhM1EUhb73qJfiCeuGBp1JSmJs4xRwM/fF3ZqRCMI3Y91iltK4rxrMCialaSDnfEoF/96suCnxwwz/Y3H+AGOcbNMnCPm2SrgGeYlco6xQgFjXLMMwQXk2xMs1inqlUe4QfeIZCZZlQntw8iQA2R8O2EgeTyT1ISZcoAAAEuSURBVHheddJVT/VQEEbhOcJR4Bju7u7u7u7u9rnL+u+UNiU0dNbNm508d7PFYySvhUrLc6qq5W1OkAtArQoikN/YRJ4KSmgV8UJIA+1sGJOiSAN+so3ppU8DBRRaTAGVUGzMMFkKKKPtZSroUEAaPntcQQ095tZR7woaIN0EGVg1t/jegjisWjJgC8h8BZFO8+WoqxsSEk72AwODkC7vGiImSawYkfeNMiaMez0iEyAuTTIlMG0AcQczzMoc8zpYYFGWWNbBCh9ljXUVeCEoYTZVsMW2yA7samCPfRHPAYcKOIJjA5xwqoAzzsUAF1wq4IrrF3DDrTsIwp157nseXEGcRzHBEx/cQBQ+WSDK5y9f4ZsDfM+CgP3l/Lj2Q2yQiP389fvPXwf4l/ovZs/e3m8a8+LLQAAAAABJRU5ErkJggg==');background-size: 100% 100%;position: absolute;/*top: 10px;*/left: 5px;content: "";}
    .comment-wrapper .content-wrapper .ping-container{margin: 2px 0 7px;}
    .comment-wrapper .content-wrapper .ping-container:after{display: block;clear: both;content: "";}
    .comment-wrapper .content-wrapper .ping-container .ping-pic{width: 96px;height: 96px;float: left;overflow: hidden;margin: 3px 3px 0 0;position: relative;background: #efece9;}
    .comment-wrapper .content-wrapper .ping-container .ping-pic>img{margin-top: -12.224px;margin-left: 0px;width: 96px;height: 128px;-webkit-user-select: none;padding: 0;margin: 0;border-radius: 0;outline: 0;-webkit-tap-highlight-color: transparent;}
    .comment-wrapper .reply-wrapper{margin-top: 5px;color: #454545;}
    .comment-wrapper .reply-wrapper .more{    display: block;line-height: 200%;font-size: 12px;margin: 6px 0;color: #3361a7;text-decoration: none;}
    .comment-wrapper .reply-wrapper .reply-list{list-style: none;padding-left: 0;}
    .comment-wrapper .reply-wrapper .reply-list .item{display: list-item;text-align: -webkit-match-parent;list-style: none;}
    .comment-wrapper .reply-wrapper .reply-list .item .fmain{text-align: left;line-height: 160%;position: relative;margin: 6px 0;word-break: break-all;word-wrap: break-word;}
    .comment-wrapper .reply-wrapper .reply-list .item .fmain .floor_footer_item{margin: 0;padding: 0;}
    .comment-wrapper .reply-wrapper .reply-list .item .fmain .floor_footer_item .user_name{color: #3361a7;
    text-decoration: none;cursor: auto;}
    .comment-wrapper .reply-wrapper .reply-list .item .fmain .floor_footer_item .floor_content{color: #000;margin-right: 6px;}
    .comment-wrapper .reply-wrapper .reply-list .item .fmain .floor_footer_item .floor_content a{color: #3361a7;text-decoration: none;}
    .comment-wrapper .reply-wrapper .reply-list .item .fmain .floor_footer_item .list_item_time{display: inline-block;margin-right: 8px;color: #c5c9cd;font-size: 12px;}


    .publish{position: fixed;left: 0;bottom: 0;width: 100%;height: 44px;z-index: 2;background-color: #f8f8f8;}
    .publish:before{z-index: 2;top: -1px;display: block;position: absolute;left: 0;border-top: 1px solid #c8c7cc;width: 100%;content: " ";pointer-events:none;}
    .publish .pub-con .pub-wrap {position: relative;width: 100%;height: 100%;}
    .publish .pub-con .pub-wrap button{position: absolute;top: 4px;right: 5px; border: 0;border-radius: 4px;width: 20%;height: 35px;font-size: 16px;text-align: center;color: #fff; background-color: #2791dc;outline: 0;-webkit-tap-highlight-color: rgba(255,255,255,0);padding: 0;margin: 0;font: 11px BlinkMacSystemFont;text-rendering: auto;letter-spacing: normal;word-spacing: normal;text-transform: none;text-indent: 0px;text-shadow: none;display: inline-block;}
    .publish .pub-con .pub-wrap input{position: absolute;width: 75%;top: 4px;left: 7px;height: 35px;border-radius: 4px;outline:0; resize:none;box-shadow:0;border-style: solid;border-color:#c8c7cc;border: 1;}
    </style>

  </head>
  <body>
    <div id="monitor">Y position: <strong id="position">0</strong></div>
    <div id="wrapper">
      <div class="container">

      <div>
                  <div class="comment-wrapper">
                    <div class="user-avatar"><img src="http://q1.qlogo.cn/g?b=qq&amp;k=CBszrbDicUgd6I2rKd2kmmg&amp;s=140&amp;t=1445487305"></div>
                    <div class="name-wrap">
                      <span class="user-nick">▂▃▅▆█▂▃▅▆█▂</span>
                      <span class="lounum">2楼</span>
                    </div>
                    <div class="content-wrapper">
                      <div class="ping-content">23333333333333</div>
                      <div class="ping-container">
                        <div class="ping-pic"><img src="http://ugc.qpic.cn/gbar_pic/dj4fAQhHmQK7m5ianVeMM4FCdDQqoiarALYa0X1MQGMEricj0faYz0SFw/200"></div>
                        <div class="ping-pic"><img src="http://ugc.qpic.cn/gbar_pic/dj4fAQhHmQK7m5ianVeMM4FCdDQqoiarALYa0X1MQGMEricj0faYz0SFw/200"></div>
                        <div class="ping-pic"><img src="http://ugc.qpic.cn/gbar_pic/dj4fAQhHmQK7m5ianVeMM4FCdDQqoiarALYa0X1MQGMEricj0faYz0SFw/200"></div>
                        <div class="ping-pic"><img src="http://ugc.qpic.cn/gbar_pic/dj4fAQhHmQK7m5ianVeMM4FCdDQqoiarALYa0X1MQGMEricj0faYz0SFw/200"></div>
                      </div>
                    </div>
                    <div class="comment-action">
                      <span class="time">11-4</span>
                      <span class="reply">11</span>
                      <span class="like">1181111</span>
                    </div>
                    <div class="reply-wrapper">
                      <ul class="reply-list">
                      <% for(var i=0;i<comments.length;i++){ 
                            if(comments[i].get("replyCommentId")==comments[i].get("inWhichComment")){ %>
                              <li class="item" data-reply="<%= comments[i].get("replyCommentId")%>">
                                <div class="fmain j_floor_main">
                                  <div class="floor_footer_item">
                                    <a href="" class="user_name "><%= comments[i].get("nickname")%></a>:
                                    <span class="floor_content"><%= comments[i].get("content")%></span>
                                    <span class="list_item_time"><%= comments[i].getCreatedAt()%></span>
                                  </div>
                                </div>
                              </li>
                            <% }else{ %>
                              <li class="item" data-reply="<%= comments[i].get("replyCommentId")%>">
                                <div class="fmain j_floor_main">
                                  <div class="floor_footer_item">
                                    <a href="" class="user_name "><%= comments[i].get("nickname")%></a>:
                                    <span class="floor_content">回复&nbsp;
                                    <a href=""><%= comments[i].get("toNickname")%></a>&nbsp;:<%= comments[i].get("content")%>
                                    </span>
                                    <span class="list_item_time"><%= comments[i].getCreatedAt()%></span>
                                  </div>
                                </div>
                              </li>
                            <% } %>
                      <% } %>
                      </ul>
                    </div>
                  </div>
        </div>
          
      </div>
    </div>
    <div class="publish" id="myModal">
        <div class="pub-con">
            <div class="pub-wrap">
              <input spellcheck="false" type="text" class="editor" placeholder="我也来说一句...." style="" />
              <button class="pub-publish">发表</button>
            </div>
        </div>
    </div>
    <script type="text/javascript">
    var reply_flag = "<%= commentObjId%>";
    $(document).ready(function(){
        $("li.item").click(function(){
          //alert("heh");
          reply_flag = $(this).attr("data-reply");
          var li_nickname = $(this).find(".user_name").html();
          li_nickname = "回复 " + li_nickname + ":";
          $(".editor").val("");
          $(".editor").attr("placeholder",li_nickname);
          $(".editor").focus();
        });
        $(".editor").blur(function(){
          if (reply_flag != "<%= commentObjId%>") {$(".editor").val("");}
          $(".editor").attr("placeholder","我也来说一句....");
          reply_flag = "<%= commentObjId%>";
        });
        $(".pub-publish").click(function(){
          var content = $(".editor").val();
          $(".editor").val("");
          alert(reply_flag);
          var aj = $.ajax({
                url:'/comment',
                data:{
                    "username":"<%= username%>",
                    "groupObjId":"<%= groupObjId%>",
                    "content":content,
                    "toWhom":"<%= toWhom%>",
                    "feedObjId":"<%= feedObjId%>",
                    "commentType":"text",
                    "isReply":"1",
                    "replyCommentId":reply_flag,
                    "inWhichComment":"<%= commentObjId%>"
                },
                type:'post',
                dataType:'json',
                success:function(data){
                    alert("okokokokokok");
                    console.log(data);
                }
            });
        });
    });
    </script>
    <script type="text/javascript">
        var myScroll;
        var position;
        var flag = 0;
        var page = 0;
        window.onload = function(){
            position = document.getElementById('position');
            myScroll = new IScroll('#wrapper', { probeType: 3, mouseWheel: true, click:true });
            myScroll.on("scroll", updataPosition);
            myScroll.on("scrollEnd", dowmPosition);
            document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
        };
        function updataPosition(){
            position.innerHTML = this.y>>0;
            if (this.y>5) {
                flag = 1;
                //console.log(flag);
            }else if(this.y<(this.maxScrollY-5)){
                flag = 2;
                //console.log(flag);
            }
        }
        function dowmPosition(){
            if (flag==1) {
                console.log("下拉加载");
                myScroll.refresh();
                flag = 0;
            }else if (flag==2) {
                console.log("上拉加载");
                for(var i=0;i<20;i++){
                    $(".container").append("<li>Pretty row 50</li>");
                }
                myScroll.refresh();
                flag = 0;
            }else{
                flag = 0;
            }
        }
    </script>
  </body>
</html>