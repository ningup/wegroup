<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>测试测试微群</title>
<meta name="renderer" content="webkit">
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<meta name="Keywords" content="{$Think.config.SITENAME}" />
<meta name="Description" content="{$Think.config.SITENAME},{$Think.config.DESCRIPTION}" />
<link rel="stylesheet" type="text/css" href="/stylesheets/index.css">
<link rel="stylesheet" type="text/css" href="/stylesheets/skin.css">
<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap.css">
<link rel="stylesheet" type="text/css" href="/stylesheets/bootstrap-switch.css">
<script language="javascript" type="text/javascript" src="/javascript/jquery.min.js"></script>
<script language="javascript" type="text/javascript" src="/javascript/bootstrap.js"></script>
<script language="javascript" type="text/javascript" src="/javascript/bootstrap-switch.js"></script>
</head>
<body>
  <a href="/feed/publish?groupObjIdGotInto=<%= groupObjIdGotInto%>&username=<%= username %>" style="position:fixed;right:20px;bottom:40px;width:40px;height:40px;border-radius:20px;text-align:center;line-height:40px;z-index:999;background-color:#f0ffff">发表</a>
  <div class="search_button">
    <div class="input-group form-control" style="width: 88%;">
      <span class="glyphicon glyphicon-search" id="sizing-addon2"></span>
      <form name"search" class="form-inline">
      <input type="search" alt="查找群帖子、成员" contextmenu="查找群帖子、成员" title="查找群帖子、成员" aria- id="search_box" class="" placeholder="查找群帖子、成员" aria-describedby="sizing-addon2"></form>
    </div>
      <span style="background: none;border: none;float: right;margin-top: -30px;width: 10%;padding: 0;"><i class="glyphicon glyphicon-camera" style="font-size: 1.6em;"></i></span>
  </div>

  <div class="container-fluid" style="background:#FFF;">
    <div class="row">
      <ul class="list-unstyled">
        <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 band_shortcut" data-link="user"><i class="glyphicon glyphicon-user"></i><p>群成员</p></div>
        <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 band_shortcut" data-link="picture"><i class="glyphicon glyphicon-picture"></i><p>群相册</p></div>
        <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 band_shortcut" data-link="stats"><i class="glyphicon glyphicon-stats"></i><p>群投票</p></div>
        <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 band_shortcut" data-link="file"><i class="glyphicon glyphicon-file"></i><p>群文件</p></div>
        <div class="col-xs-3 col-sm-3 col-md-3 col-lg-3 band_shortcut" data-link="comment"><i class="glyphicon glyphicon-comment"></i><p>群消息</p></div>
      </ul>
    </div>
  </div>
  
  <!--<div class="magin_0">
    <div class="group-bg">
          <div class="bg_img" style="background: url(http://coresos.phinf.naver.net/a/2g61f4_4/g89Ud0158aic1exyaq1q_8u3vvy.jpg);background-size:cover;"></div>
    </div>
          <div class="bl-wi-color"></div>
  </div>--><!-- 顶部图片-->

  <div class="chat_list" style="width:92%;margin:10px auto;">
      <div class="media" style=" margin-top:15px;">
        <div class="media_content">
          <div class="media-heading" data-skin="skin8">
            <div class="media-body media-middle" data-skin_factor="color" style="width:4em"><h5 class="media-heading" data-textover="1" style="margin-top: 0;"><strong>告知</strong></h5></div>
            <i class="glyphicon glyphicon-edit" style="float: right;top: -26px;color: #47B1FD;font-size: 1.7em;"></i>
          </div>
          <div class="media-gonggao">
            <div class="media-bottom media-middle">测试内容，测试内容</div>
          </div>
            <textarea id="gonggaoedit" class="hidden form-control" style="width:100%;" rows="3" maxlength="140" ></textarea>
        </div>
            </div>
  
    <ul class="list-unstyled">
        <!--<for start="1" end="5">-->
        <% for(var i=0; i<feeds.length; i++) {%>
        
      <li class="media" data-looktype="bandLook" data-read="0" data-skin="skin9" style="margin-top:18px" data-feedid="<%= feeds[i].getObjectId()%>">
        <div class="media_content">
          <div class="media-heading">
            <div class="media-left media-middle"><img class="media-object img-circle" data-src="holder.js/46x46" alt="46x46" src="http://coresos.phinf.naver.net/a/2g61f4_4/g89Ud0158aic1exyaq1q_8u3vvy.jpg" data-holder-rendered="true" style="width: 46px; height: 46px;"></div>
            <div class="media-body media-middle"><h5 class="media-heading" data-textover="1" style="margin-top: 0;color:#000"><strong>姓名</strong></h5><p data-textover="1" style="color:#999;margin-bottom: 0;"><small>{$i}分钟前</small></p></div>
          </div>
          <div class="media-footing">
            <div class="media-bottom media-middle"><p><%= feeds[i].get('feedContent')%></p></div>
            <div data-type="pic">
            <!--<for name="j" start="1" end="7">-->
            <% for(var j=0; j<(feeds[i].get('feedImgArraySmall')).length; j++) {%>
                <img class="media-object" src="<%=(feeds[i].get('feedImgArraySmall'))[j] %>" data-holder-rendered="true">
            <% } %>
            <!--</for>-->
            </div>
            <div data-type="custom"><div data-share="custom"></div><div data-share="custom-info"><h5 class="media-heading" style="margin-top: 0;color:#000">标题标题</h5><p style="color:#999;margin-bottom: 0;"><small>{$i}分钟前</small></p></div></div>
          </div>
        </div>
                <div class="media_btn">
                  <span class="col-xs-6 col-sm-6 col-md-6 col-lg-6 button_like" style="border-right: solid 1px #fff;" data-feedid="<%= feeds[i].getObjectId()%>"><i class="glyphicon glyphicon-thumbs-up"></i> 赞<span class="like"><%=feeds[i].get('likeNum')%></span></span>
                    <span class="col-xs-6 col-sm-6 col-md-6 col-lg-6 pubcomentbtn" style="border-left: solid 1px #DDD;"><i class="glyphicon glyphicon-comment"></i> 发表评论</span>
                </div>

        
        <ul class="comment list-unstyled">
          <!--<for name="k" start="1" end="4">-->
          <% for(var j=0; j<conments.length; j++) {%>
            <li class="media_content" style="background: #F4F4F4;border-bottom: solid 1.2px #DBDBDB;">
              <div class="media-heading user_comment" data-whoid="conments[j].get('who')" > 
                <div class="media-left media-middle"><img class="media-object img-circle" data-src="holder.js/46x46" alt="46x46" src="http://coresos.phinf.naver.net/a/2g61f4_4/g89Ud0158aic1exyaq1q_8u3vvy.jpg" data-holder-rendered="true" style="width: 46px; height: 46px;"></div>
                <div class="media-body media-middle"><h5 class="media-heading" data-textover="1" style="margin-top: 6px;color:#000;"><strong>姓名</strong><small class="pull-right">{$i}分钟前</small></h5><div class="media-bottom media-middle"><p>测试内容，测试内容</p></div></div>
              </div>
            </li>
          <% } %>
          <!--</for>-->
        </ul>
            </li>

    <% } %>
    <!--</for>-->
        </ul>

            <div class="media_content pinglunkuang hidden" style="background: #F4F4F4;border-bottom: solid 1.2px #DBDBDB;position:fixed;left:0px;bottom:0px;">
              <div class="media-heading">
                <div class="media-left_content media-middle container-fluid"><textarea class="form-control" rows="3" class="container-fluid" id="content-comment"></textarea></div>
                <div class="media-right-conbtn"><button type="button" class="btn btn-success button_commit">评论</button></div>
              </div>
            </div>

  </div>
  
<script>
var who_flag = 0;
var feed_id_flag = "";
var toUsername = "";
$('.glyphicon-edit').click(function(){
  if($('#gonggaoedit').hasClass('hidden')){
    $('#gonggaoedit').removeClass('hidden');
    $('.media-gonggao').addClass('hidden');
    $('#gonggaoedit').val($('.media-gonggao').find('.media-bottom').html());
  }else{
    $('#gonggaoedit').addClass('hidden');
    $('.media-gonggao').removeClass('hidden');
    $('.media-gonggao').find('.media-bottom').html($('#gonggaoedit').val());
  }
})
$('.pubcomentbtn').click(function(){
  if($('.pinglunkuang').hasClass('hidden')){
    $('.pinglunkuang').removeClass('hidden');
    feed_id_flag = $(this).closest("li[data-looktype='bandLook']").attr('data-feedid');
    who_flag = 1;
  }else{
    $('.pinglunkuang').addClass('hidden');
    feed_id_flag = "";
    who_flag = 0;
  }
  })
$(".user_comment").click(function(){
  if($('.pinglunkuang').hasClass('hidden')){
    $('.pinglunkuang').removeClass('hidden');
    feed_id_flag = $(this).closest("li[data-looktype='bandLook']").attr('data-feedid');
    who_flag = 2;
    toUsername = $(this).attr('data-whoid');
  }else{
    $('.pinglunkuang').addClass('hidden');
    feed_id_flag = "";
    who_flag = 0;
    toUsername = "";
  }
})
$('[data-link=user]').click(function(){
  window.open("/feed/groupMember?groupObjIdGotInto=<%= groupObjIdGotInto%>&username=<%= username %>");
})
$('[data-link=picture]').click(function(){
  window.open("{:U('Group/album')}","_self");
})
$('[data-link=stats]').click(function(){
  window.open("{:U('Group/member')}","_self");
})
$('[data-link=file]').click(function(){
  window.open("{:U('Group/filescontant')}","_self");
})
$('[data-link=comment]').click(function(){
  window.open("{:U('Group/message')}","_self");
})
$('.button_like').click(function(){
  window.console.log("进来了");
  //var feed_id = $(this).attr('data-feedid');
  var feed_id = $(this).closest("li[data-looktype='bandLook']").attr('data-feedid');
  var aj = $.ajax({
    url:'/comment/like',
    data:{
      "username":"<%=username%>",
      "feedObjId":feed_id
    },
    type:'post',
    dataType:'json',
    success:function(data){
        window.console.log(data);
        
        var likeNum = data.likeNum;
        var feedObjId = data.feedObjId;
        var find_id = "span[data-feedid='" + feedObjId + "']";
        window.console.log(likeNum);
        window.console.log(find_id);
        $(find_id).find('span.like').html(likeNum);
    },
    error:function(){
      alert('出错了');
    }
  });
})
$('.button_commit').click(function(){
    //var feed_id = $(this).closest("li[data-looktype='bandLook']").attr('data-feedid');
    var content =  $("#content-comment").val();
    if (who_flag==1) {
        var aj_commit = $.ajax({
        url:'/comment',
        data:{
          "username":"<%=username%>",
          "feedObjId":feed_id_flag,
          "content":content
        },
        type:'post',
        dataType:'json',
        success:function(data){
            window.console.log("评论已经成功");
            window.console.log(data);
            
            var likeNum = data.likeNum;
            var feedObjId = data.feedObjId;
            var find_id = "span[data-feedid='" + feedObjId + "']";
            window.console.log(likeNum);
            window.console.log(find_id);
            $(find_id).find('span.like').html(likeNum);
        },
        error:function(){
          alert('出错了');
        }
      });
    }else if (who_flag==2) {
        var aj_commit = $.ajax({
        url:'/comment',
        data:{
          "username":"<%=username%>",
          "feedObjId":feed_id_flag,
          "content":content,
          "toUsername":toUsername
        },
        type:'post',
        dataType:'json',
        success:function(data){
            window.console.log("评论已经成功");
            window.console.log(data);
            
            var likeNum = data.likeNum;
            var feedObjId = data.feedObjId;
            var find_id = "span[data-feedid='" + feedObjId + "']";
            window.console.log(likeNum);
            window.console.log(find_id);
            $(find_id).find('span.like').html(likeNum);
        },
        error:function(){
          alert('出错了');
        }
      });
    }
})
</script>
</body>
</html>